<!doctype html>
<html class="docs-html">

<head>
  <meta charset="utf-8">
  <title>Collections - Telenor NB-IoT Docs and Tutorials</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Twitter Card data -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Collections - Telenor NB-IoT Docs and Tutorials">
  <meta name="twitter:description" content="">
  <meta name="twitter:image" content="https://docs.nbiot.engineering/img/og_image.jpg">

  <!-- Open Graph data -->
  <meta property="og:title" content="Collections - Telenor NB-IoT Docs and Tutorials" />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="https://docs.nbiot.engineering/api/collections.html" />
  <meta property="og:image" content="https://docs.nbiot.engineering/img/og_image.jpg" />
  <meta property="og:description" content="" />
  <meta property="og:site_name" content="Telenor NB-IoT Docs and Tutorials" />

  <link rel="stylesheet" type="text/css" href="/style/style.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link id="searchIndex" href="/index.json" rel="preload" as="fetch">
</head>

<body class="docs-body">
  <div class="docs-brand-border"></div>
  <div id="docs-topbar" class="docs-topbar no-print">
    <div id="docs-topbar__inner" class="docs-topbar__inner">
      <a href="#" id="docs-menu-toggle" class="docs-topbar__icon docs-topbar__icon--menu-toggle hidden-desktop"><i
          class="material-icons md-24">menu</i></a>
      <a href="#" id="docs-search-hide" class="docs-topbar__icon docs-topbar__icon--search-hide hidden-desktop"><i
          class="material-icons md-24">arrow_back</i></a>
      <div class="docs-topbar__icon docs-topbar__icon--search visible-desktop"><i class="material-icons md-24">search</i></div>
      <input id="docs-search-box" type="text" class="docs-topbar__search-box" placeholder="Search" tabindex="1"
        autocapitalize="none" autocomplete="off" autocorrect="off" autofocus />
      <a href="#" id="docs-search-close" class="docs-topbar__icon docs-topbar__icon--search-close"><i class="material-icons md-24">close</i></a>
      <a href="#" id="docs-search-show" class="docs-topbar__icon docs-topbar__icon-search-show hidden-desktop"><i class="material-icons md-24">search</i></a>

      <a class="docs-topbar__link visible-desktop" href="https://github.com/ExploratoryEngineering/docs.nbiot.engineering">On Github</a>
    </div>
    <div id="docs-search" class="docs-search">
      <ul id="docs-search-results" class="docs-search-results"></ul>
    </div>
  </div>
  <div id="docs-sidebar" class="docs-sidebar visible-desktop no-print">
    <nav class="docs-nav">
      <a class="docs-nav__logo" href="/">NB-IoT Docs</a>
      <ul class="docs-nav__ul">
              <li class="docs-nav__li docs-nav__li--subgroup">
                        <a href="/tutorials.html" class="docs-nav__item">Tutorials</a>
                  <ul class="docs-nav__ul">
                          <li class="docs-nav__li">
                                    <a href="/tutorials/getting-started.html" class="docs-nav__item">Getting started with Telenor NB-IoT Developer Platform</a>
                          </li>
                          <li class="docs-nav__li">
                                    <a href="/tutorials/interactive-terminal.html" class="docs-nav__item">Interactive terminal</a>
                          </li>
                          <li class="docs-nav__li">
                                    <a href="/tutorials/arduino-basic.html" class="docs-nav__item">Arduino getting started</a>
                          </li>
                          <li class="docs-nav__li">
                                    <a href="/tutorials/microbit-basic.html" class="docs-nav__item">NB-IoT on micro:bit</a>
                          </li>
                          <li class="docs-nav__li">
                                    <a href="/tutorials/nrf9160-basic.html" class="docs-nav__item">nRF9160 DK getting started</a>
                              <ul class="docs-nav__ul">
                                      <li class="docs-nav__li">
                                                <a href="/tutorials/nrf9160-basic/virtualbox.html" class="docs-nav__item">VirtualBox</a>
                                      </li>
                              </ul>
                          </li>
                          <li class="docs-nav__li">
                                    <a href="/tutorials/raspi-serial.html" class="docs-nav__item">Raspberry Pi getting started</a>
                          </li>
                          <li class="docs-nav__li">
                                    <a href="/tutorials/arduino-serial-forwarder.html" class="docs-nav__item">Arduino as serial adapter</a>
                          </li>
                          <li class="docs-nav__li">
                                    <a href="/tutorials/low-power.html" class="docs-nav__item">Conserving battery power</a>
                          </li>
                  </ul>
              </li>
              <li class="docs-nav__li docs-nav__li--subgroup">
                        <a href="/libs.html" class="docs-nav__item">Client libraries</a>
                  <ul class="docs-nav__ul">
                          <li class="docs-nav__li">
                                    <a href="/libs/csharp.html" class="docs-nav__item">C#</a>
                          </li>
                          <li class="docs-nav__li">
                                    <a href="/libs/go.html" class="docs-nav__item">Go</a>
                          </li>
                          <li class="docs-nav__li">
                                    <a href="/libs/java.html" class="docs-nav__item">Java</a>
                          </li>
                          <li class="docs-nav__li">
                                    <a href="/libs/python.html" class="docs-nav__item">Python</a>
                          </li>
                  </ul>
              </li>
              <li class="docs-nav__li docs-nav__li--subgroup">
                        <a href="/api.html" class="docs-nav__item">REST API</a>
                  <ul class="docs-nav__ul">
                          <li class="docs-nav__li">
                                    <a href="/api/collections.html" class="docs-nav__item">Collections</a>
                          </li>
                          <li class="docs-nav__li">
                                    <a href="/api/devices.html" class="docs-nav__item">Devices</a>
                          </li>
                          <li class="docs-nav__li">
                                    <a href="/api/outputs.html" class="docs-nav__item">Outputs</a>
                          </li>
                          <li class="docs-nav__li">
                                    <a href="/api/teams.html" class="docs-nav__item">Teams</a>
                          </li>
                          <li class="docs-nav__li">
                                    <a href="/api/invites.html" class="docs-nav__item">Team invites</a>
                          </li>
                          <li class="docs-nav__li">
                                    <a href="/api/tags.html" class="docs-nav__item">Tags on resources</a>
                          </li>
                          <li class="docs-nav__li">
                                    <a href="/api/tokens.html" class="docs-nav__item">Tokens</a>
                          </li>
                          <li class="docs-nav__li">
                                    <a href="/api/firmware.html" class="docs-nav__item">Firmware Over the Air (FOTA)</a>
                          </li>
                          <li class="docs-nav__li">
                                    <a href="/api/methods.html" class="docs-nav__item">HTTP Methods</a>
                          </li>
                          <li class="docs-nav__li">
                                    <a href="/api/status_codes.html" class="docs-nav__item">Status codes</a>
                          </li>
                          <li class="docs-nav__li">
                                    <a href="/api/errors.html" class="docs-nav__item">Errors</a>
                          </li>
                  </ul>
              </li>
      </ul>
      <hr class="docs-nav__hr" />
      <ul class="docs-nav__ul">
              <li class="docs-nav__li">
                        <a href="/about.html" class="docs-nav__item">About</a>
              </li>
              <li class="docs-nav__li">
                        <a href="/faq.html" class="docs-nav__item">FAQ</a>
              </li>
      </ul>
      <div class="docs-sidebar__menuLinks hidden-desktop">
        <hr class="docs-nav__hr" />
        <ul class="docs-nav__ul">
          <li class="docs-nav__li">
            <a href="https://github.com/ExploratoryEngineering/docs.nbiot.engineering" class="docs-nav__item">On Github</a>
          </li>
        </ul>
      </div>
    </nav>
  </div>
  <div id="barba-wrapper" class="docs-wrapper">
    <div class="docs-content barba-container">
      <h1>Collections</h1>
      <ol class="docs-breadcrumbs tn-breadcrumbs visible-desktop">
              <li class="tn-breadcrumb">
                  <a href="/">Home</a>
              </li>
            <li class="tn-breadcrumb">
                    <a href="/api.html">REST API</a>
            </li>
          <li class="tn-breadcrumb tn-breadcrumb--active">Collections</li>
      </ol>
      <html><head></head><body><p>Collections makes it easier to manage large and small sets of devices and to
group devices into logical groups. By default you&#x2019;ll have a single collection
where all devices you create will be put into. A device can&#x2019;t be a member of
more than one collection at a time.</p>
<p>Devices can be shared between team members by having a shared collection owned
by the team.</p>
<h2 id="list-of-collections-collections">List of collections: <code>/collections</code></h2>
<p>The list of collections contains a list of all collections you have access to,
both read-only and read-write (ie you can administer). New collections can
be created by POSTing to this resource.</p>
<pre><code class="hljs bash">$ curl -HX-API-Token:<span class="hljs-variable">${TOKEN}</span> https://api.nbiot.telenor.io/collections
{
  <span class="hljs-string">&quot;collections&quot;</span>: [
    {
      <span class="hljs-string">&quot;collectionId&quot;</span>: <span class="hljs-string">&quot;17dh0cf43jfgl8&quot;</span>,
      <span class="hljs-string">&quot;teamId&quot;</span>: <span class="hljs-string">&quot;17dh0cf43jfgl8&quot;</span>,
      <span class="hljs-string">&quot;tags&quot;</span>: {
        <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;My default collection&quot;</span>
      },
      <span class="hljs-string">&quot;fieldMask&quot;</span>: {
        <span class="hljs-string">&quot;imsi&quot;</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-string">&quot;imei&quot;</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-string">&quot;location&quot;</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-string">&quot;msisdn&quot;</span>: <span class="hljs-literal">false</span>
      }
    }
  ]
}</code></pre>

<h3 id="field-masks">Field masks</h3>
<p>Fields with potentially sensitive data can be masked (i.e. removed) from the API responses.
These fields can be toggled on and off individually and the fields won&#x2019;t show up
outside of the API or in the data outputs from the collections.  A value of <code>true</code> for a
field mask indicates that the field will <em>not</em> appear in API responses.</p>
<p>Even if IMSI or IMEI are masked, the fields are still required when creating a
new device.</p>
<p>A field mask for a collection applies to all devices in that collection.</p>
<p>There is a fixed field mask configuration for the entire system, which can be retrieved by querying the <code>/system</code> url:</p>
<pre><code class="hljs bash">$ curl -HX-API-Token:<span class="hljs-variable">${TOKEN}</span> https://api.nbiot.telenor.io/system
{
  <span class="hljs-string">&quot;defaultFieldMask&quot;</span>: {
    <span class="hljs-string">&quot;imsi&quot;</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-string">&quot;imei&quot;</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-string">&quot;location&quot;</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-string">&quot;msisdn&quot;</span>: <span class="hljs-literal">false</span>
  },
  <span class="hljs-string">&quot;forcedFieldMask&quot;</span>: {
    <span class="hljs-string">&quot;imsi&quot;</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-string">&quot;imei&quot;</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-string">&quot;location&quot;</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-string">&quot;msisdn&quot;</span>: <span class="hljs-literal">false</span>
  }
}</code></pre>

<p>The <code>defaultFieldMask</code> shows the default mask applied to new collections when <code>fieldMask</code> is not specified when creating a new collection.</p>
<p>The <code>forcedFieldMask</code> shows the system&#x2019;s field mask settings.  A value of <code>true</code> in <code>forcedFieldMask</code> means the field will never appear in API responses, even if the <code>fieldMask</code> for a collection has <code>false</code> for that field.</p>
<h3 id="creating-a-new-collection">Creating a new collection</h3>
<p>Send a <code>POST</code> request to the <code>/collections</code> resource to create a new collection. There is
no required fields so an empty JSON object is sufficient. It is recommended to use the <a href="/api/tags.html">tags</a>
resource and add an attribute named <code>name</code> to identify the collection. The console will use this attribute
when displaying the list of collections.</p>
<pre><code class="hljs bash">$ curl -HX-API-Token:<span class="hljs-variable">${TOKEN}</span> -XPOST <span class="hljs-_">-d</span><span class="hljs-string">&apos;{&quot;tags&quot;:{&quot;name&quot;: &quot;My first collection&quot;}}&apos;</span> \
    https://api.nbiot.telenor.io/collections
{
  <span class="hljs-string">&quot;collectionId&quot;</span>: <span class="hljs-string">&quot;17dh0cf43jfgli&quot;</span>,
  <span class="hljs-string">&quot;teamId&quot;</span>: <span class="hljs-string">&quot;17dh0cf43jfgl8&quot;</span>,
  <span class="hljs-string">&quot;tags&quot;</span>: {
    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;My first collection&quot;</span>
  },
  <span class="hljs-string">&quot;fieldMask&quot;</span>: {
    <span class="hljs-string">&quot;imsi&quot;</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-string">&quot;imei&quot;</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-string">&quot;location&quot;</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-string">&quot;msisdn&quot;</span>: <span class="hljs-literal">false</span>
  }
}</code></pre>

<h2 id="collection-detail-collections-collectionid-">Collection detail: <code>/collections/{collectionId}</code></h2>
<p>Details for each collection is available at the detail resource:</p>
<pre><code class="hljs bash">curl -HX-API-Token:<span class="hljs-variable">${TOKEN}</span> https://api.nbiot.telenor.io/collections/17dh0cf43jfgli
{
  <span class="hljs-string">&quot;collectionId&quot;</span>: <span class="hljs-string">&quot;17dh0cf43jfgli&quot;</span>,
  <span class="hljs-string">&quot;teamId&quot;</span>: <span class="hljs-string">&quot;17dh0cf43jfgl8&quot;</span>,
  <span class="hljs-string">&quot;tags&quot;</span>: {
    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;My first collection&quot;</span>
  },
  <span class="hljs-string">&quot;fieldMask&quot;</span>: {
    <span class="hljs-string">&quot;imsi&quot;</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-string">&quot;imei&quot;</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-string">&quot;location&quot;</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-string">&quot;msisdn&quot;</span>: <span class="hljs-literal">false</span>
  }
}</code></pre>

<h3 id="updating-a-collection">Updating a collection</h3>
<p>Use <code>PATCH</code> to update the collection. You must be the administrator of the team owning the
collection <em>and</em> and administrator of the team you assign the collection to if you change the ownership
of an collection.</p>
<pre><code class="hljs bash">$ curl -HX-API-Token:<span class="hljs-variable">${TOKEN}</span> -XPATCH <span class="hljs-_">-d</span><span class="hljs-string">&apos;{&quot;teamId&quot;: &quot;17dh0cf43jfgl9&quot;}&apos;</span> \
    https://api.nbiot.telenor.io/collections/17dh0cf43jfgli
{
  <span class="hljs-string">&quot;collectionId&quot;</span>: <span class="hljs-string">&quot;17dh0cf43jfgli&quot;</span>,
  <span class="hljs-string">&quot;teamId&quot;</span>: <span class="hljs-string">&quot;17dh0cf43jfgl9&quot;</span>,
  <span class="hljs-string">&quot;tags&quot;</span>: {
    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;My first collection&quot;</span>
  },
  <span class="hljs-string">&quot;fieldMask&quot;</span>: {
    <span class="hljs-string">&quot;imsi&quot;</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-string">&quot;imei&quot;</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-string">&quot;location&quot;</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-string">&quot;msisdn&quot;</span>: <span class="hljs-literal">false</span>
  }
}</code></pre>

<p>The server responds with the updated collection when successful.</p>
<h3 id="removing-a-collection">Removing a collection</h3>
<p>Use <code>DELETE</code> to remove a collection. The collection can&#x2019;t contain any devices or outputs when it is deleted.</p>
<pre><code class="hljs bash">$ curl -HX-API-Token:<span class="hljs-variable">${TOKEN}</span> -XDELETE https://api.nbiot.telenor.io/collections/17dh0cf43jfgli</code></pre>

<p>The server responds with a <code>204 NO CONTENT</code> when a collection is removed.</p>
<h2 id="collection-data-stream-collections-collectionid-from">Collection data stream: <code>/collections/{collectionId}/from</code></h2>
<p>The server provides a WebSocket to monitor the output (ie the <em>upstream</em> data)
of the devices. All data transmitted by the devices will be forwarded to the
WebSocket.</p>
<p>The data sent by the devices are included in the field <code>payload</code> and is <a href="https://en.wikipedia.org/wiki/Base64">base64-encoded</a>.</p>
<pre><code class="hljs json">{
  <span class="hljs-attr">&quot;device&quot;</span>: {
    <span class="hljs-attr">&quot;deviceId&quot;</span>:<span class="hljs-string">&quot;17dh0cf43jfgl8&quot;</span>,
    <span class="hljs-attr">&quot;collectionId&quot;</span>:<span class="hljs-string">&quot;17dh0cf43jfgli&quot;</span>,
    <span class="hljs-attr">&quot;imei&quot;</span>:<span class="hljs-string">&quot;111222333444&quot;</span>,
    <span class="hljs-attr">&quot;imsi&quot;</span>:<span class="hljs-string">&quot;123456789&quot;</span>,
    <span class="hljs-attr">&quot;tags&quot;</span>:{
      <span class="hljs-attr">&quot;name&quot;</span>:<span class="hljs-string">&quot;My first device&quot;</span>
    }
  },
  <span class="hljs-attr">&quot;payload&quot;</span>:<span class="hljs-string">&quot;WXVwIHRoaXMgaXMgdGhlIHBheWxvYWQ=&quot;</span>,
  <span class="hljs-attr">&quot;received&quot;</span>:<span class="hljs-number">1538163685141</span>,
  <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;data&quot;</span>,
  <span class="hljs-attr">&quot;transport&quot;</span>: <span class="hljs-string">&quot;&lt;transport used by the device to deliver the data&gt;&quot;</span>,
  <span class="hljs-attr">&quot;coapMetaData&quot;</span>: {
    <span class="hljs-attr">&quot;method&quot;</span>: <span class="hljs-string">&quot;POST&quot;</span>,
    <span class="hljs-attr">&quot;path&quot;</span>: <span class="hljs-string">&quot;&lt;path used by device&quot;</span>&gt;
  },
  <span class="hljs-attr">&quot;udpMetaData&quot;</span>: {
    <span class="hljs-attr">&quot;localPort&quot;</span>: <span class="hljs-string">&quot;&lt;the backend&apos;s local port&gt;&quot;</span>,
    <span class="hljs-attr">&quot;remotePort&quot;</span>: <span class="hljs-string">&quot;&lt;the port used on the device&gt;&quot;</span>
  }
}</code></pre>

<p>The <code>transport</code> field is set to one of the supported transports for upstream
messages &#x2013; currently this is <code>udp</code> and <code>coap-push</code>. The <code>coapMetaData</code> struct
is only included if the <code>transport</code> field is set to <code>coap-push</code> and the
<code>udpMetaData</code> struct is only included if the <code>transport</code> field is set to <code>udp</code>.</p>
<p>At regular intervals the server will send a keepAlive message on the WebSocket:</p>
<pre><code class="hljs json">{
  <span class="hljs-attr">&quot;keepAlive&quot;</span>: <span class="hljs-literal">true</span>
}</code></pre>

<p>The keep-alive message will only be sent if there has been no data for 30s.</p>
<h3 id="api-key-as-query-parameter">API key as query parameter</h3>
<p>Most WebSocket libraries doesn&#x2019;t support headers in requests; the API token can
be supplied through the <code>api_token</code> parameter. The API token <em>must</em> be readonly.</p>
<h2 id="downstream-data-collections-collectionid-to">Downstream data: <code>/collections/{collectionId}/to</code></h2>
<p>If you want to send data <strong>to</strong> the devices <code>POST</code> to this resource.
There are three kinds of transports that can be selected via the <code>transport</code> field:</p>
<p>1) <code>udp</code> which will send a regular udp packet to the device on the specified
   port immediately. The <code>port</code> field is required and the device must be listening
   on the port to receive the message.
2) <code>coap-pull</code> which will queue the message and send it as a response to a
   CoAP <code>GET</code> request from the device. The device is responsible for polling the
   backend.
3) <code>coap-push</code> which will send the message to the device immediately as a CoAP
   <code>POST</code> to the path specified in the <code>path</code> parameter. The device must be
   running a CoAP server for this to work.</p>
<p>The <code>payload</code> field is required for all types. If the <code>transport</code> field is
blank it will use the <code>udp</code> transport by default.</p>
<pre><code class="hljs json">{
  &quot;transport&quot;: &quot;&lt;udp, coap-push, coap-pull&gt;&quot;,
  &quot;port&quot;: &lt;port number, required for udp, optional for coap-push, ignored for coap-pull&gt;,
  &quot;payload&quot;: &quot;&lt;base 64 encoded bytes&gt;&quot;,
  &quot;path&quot;: &quot;&lt;path for coap-pull transport&gt;&quot;
}</code></pre>

<h3 id="response">Response</h3>
<p>The response contains an array of error messages. The array might be empty. The
<code>sent</code> and <code>failed</code> fields shows how many messages have been sent and how many
messages failed to send.</p>
<pre><code class="hljs json">{
  <span class="hljs-attr">&quot;errors&quot;</span>: [
    {
      <span class="hljs-attr">&quot;deviceId&quot;</span>: <span class="hljs-string">&quot;&lt;the device ID&gt;&quot;</span>,
      <span class="hljs-attr">&quot;message&quot;</span>: <span class="hljs-string">&quot;&lt;error message&gt;&quot;</span>
    }
  ],
  <span class="hljs-attr">&quot;sent&quot;</span>: &lt;number of messages sent&gt;,
  <span class="hljs-attr">&quot;failed&quot;</span>: &lt;number of failed messages&gt;
}</code></pre></body></html>
      <div class="lesson-nav">
      </div>
      <a class="docs-edit-btn no-print" href="https://github.com/ExploratoryEngineering/docs.nbiot.engineering/edit/master/docs/api/collections.md" target="_blank">Edit this page</a>
    </div>
  </div>
  <script src="/script/vendor.js"></script>
  <script src="/script/script.js"></script>
</body>

</html>
